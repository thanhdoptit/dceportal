# DCE System - H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng Chi Ti·∫øt

## üìã **M·ª•c L·ª•c**
1. [C·∫•u h√¨nh Environment](#c·∫•u-h√¨nh-environment)
2. [Monitoring System](#monitoring-system)
3. [Database Backup](#database-backup)
4. [Application Backup](#application-backup)
5. [Smart Backup](#smart-backup)
6. [Maintenance](#maintenance)
7. [Troubleshooting](#troubleshooting)

---

## üîß **1. C·∫•u h√¨nh Environment**

### **B∆∞·ªõc 1: Ki·ªÉm tra file .env**
```powershell
# Ki·ªÉm tra file .env c√≥ t·ªìn t·∫°i kh√¥ng
Get-Content "D:\Project\app\backend\.env"
```

### **B∆∞·ªõc 2: Load Environment Variables**
```powershell
# Ch·∫°y script c·∫•u h√¨nh environment
.\scripts\configure-env.ps1
```

### **B∆∞·ªõc 3: Ki·ªÉm tra Environment Variables**
```powershell
# Ki·ªÉm tra c√°c bi·∫øn m√¥i tr∆∞·ªùng ƒë√£ load
echo $env:DB_HOST
echo $env:DB_NAME
echo $env:DB_USER
# DB_PASS s·∫Ω hi·ªÉn th·ªã *** ƒë·ªÉ b·∫£o m·∫≠t
```

---

## üîç **2. Monitoring System**

### **2.1. Monitoring C∆° B·∫£n**
```powershell
# Ch·∫°y monitoring system
.\scripts\improved-monitoring.ps1
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
```
=== DCE System - Improved Monitoring ===
Thoi gian: 08/24/2025 17:15:02

1. System Resources:
CPU Usage: 17%
Memory Usage: 57.5% (9.12 GB / 15.86 GB)
Disk Space: 16.16 GB free of 222.78 GB total

2. Service Status:
SQL Server: Running (Service: MSSQL$SQLEXPRESS)
Web Server: Not Found
Cache Server: Not Found
DCE Backend: Not Found
DCE Frontend: Not Found

3. Port Availability:
Port 80 (HTTP): Open
Port 443 (HTTPS): Closed
Port 1433 (SQL Server): Open
Port 5000 (DCE Backend): Open
Port 3000 (DCE Frontend): Open
Port 6379 (Redis): Closed

4. Database Connection:
Database Connection: Success

5. Application Health:
Backend Health: 200
Frontend Health: 200
```

### **2.2. Gi·∫£i th√≠ch c√°c Metrics**

#### **System Resources:**
- **CPU Usage**: S·ª≠ d·ª•ng CPU hi·ªán t·∫°i (d∆∞·ªõi 80% l√† t·ªët)
- **Memory Usage**: S·ª≠ d·ª•ng RAM (d∆∞·ªõi 90% l√† t·ªët)
- **Disk Space**: Dung l∆∞·ª£ng ·ªï ƒëƒ©a c√≤n tr·ªëng

#### **Service Status:**
- **SQL Server**: Ph·∫£i l√† "Running"
- **DCE Backend/Frontend**: C√≥ th·ªÉ "Not Found" n·∫øu ch∆∞a c√†i service

#### **Port Availability:**
- **Port 1433**: SQL Server (ph·∫£i Open)
- **Port 5000**: Backend API (ph·∫£i Open)
- **Port 3000**: Frontend (ph·∫£i Open)

#### **Application Health:**
- **Backend Health**: Ph·∫£i l√† 200 (OK)
- **Frontend Health**: Ph·∫£i l√† 200 (OK)

---

## üíæ **3. Database Backup**

### **3.1. Full Backup (Khuy·∫øn ngh·ªã h√†ng ng√†y)**
```powershell
# Full backup v·ªõi verification
.\scripts\backup\database-backup.ps1 -BackupType Full -Verify
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
```
Starting database backup...
  Creating full backup...
10 percent processed.
20 percent processed.
...
100 percent processed.
BACKUP DATABASE successfully processed 2777 pages in 0.097 seconds (223.642 MB/sec).
  Full backup completed: D:\backup\database\webdce_FULL_20250824_171430.bak
  Verifying backup...
The backup set on file 1 is valid.
  Backup verification passed: D:\backup\database\webdce_FULL_20250824_171430.bak
```

### **3.2. Differential Backup (H√†ng gi·ªù)**
```powershell
# Differential backup
.\scripts\backup\database-backup.ps1 -BackupType Differential
```

### **3.3. Transaction Log Backup (M·ªói 15 ph√∫t)**
```powershell
# Transaction log backup
.\scripts\backup\database-backup.ps1 -BackupType Log
```

### **3.4. Backup T·∫•t C·∫£ + Cleanup**
```powershell
# Backup t·∫•t c·∫£ lo·∫°i + x√≥a backup c≈©
.\scripts\backup\database-backup.ps1 -BackupType All -Cleanup
```

### **3.5. Ki·ªÉm tra Backup Files**
```powershell
# Xem danh s√°ch backup files
Get-ChildItem "D:\backup\database\" | Sort-Object CreationTime -Descending

# Xem k√≠ch th∆∞·ªõc backup
Get-ChildItem "D:\backup\database\" | Select-Object Name, Length, CreationTime
```

---

## üìÅ **4. Application Backup**

### **4.1. Smart Backup C∆° B·∫£n**
```powershell
# Backup essential files
.\scripts\backup\application-backup.ps1
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
```
Starting smart application backup...
  Backing up essential application files...
    Backed up: backend\src
    Backed up: backend\package.json
    Backed up: backend\package-lock.json
    Backed up: frontend\src
    Backed up: frontend\package.json
    Backed up: frontend\package-lock.json
    Backed up: frontend\vite.config.js
    Backed up: frontend\index.html
    Backed up: nginx\conf
    Backed up: scripts
    Backed up: uploads
  Smart application backup completed: D:\backup\application\app-backup-20250824_171456
  Backup size: 5.22 MB
  Items backed up: 11
```

### **4.2. Backup v·ªõi Configuration**
```powershell
# Backup + configuration files (.env, nginx config)
.\scripts\backup\application-backup.ps1 -IncludeConfig
```

### **4.3. Backup v·ªõi Uploads v√† Logs**
```powershell
# Backup + uploads v√† logs
.\scripts\backup\application-backup.ps1 -IncludeUploads -IncludeLogs
```

### **4.4. Backup v·ªõi Compression**
```powershell
# Backup + n√©n file
.\scripts\backup\application-backup.ps1 -Compress
```

### **4.5. Backup ƒê·∫ßy ƒê·ªß + Cleanup**
```powershell
# Backup t·∫•t c·∫£ + n√©n + x√≥a backup c≈©
.\scripts\backup\application-backup.ps1 -IncludeConfig -IncludeUploads -IncludeLogs -Compress -Cleanup
```

### **4.6. Ki·ªÉm tra Application Backup**
```powershell
# Xem danh s√°ch application backup
Get-ChildItem "D:\backup\application\" | Sort-Object CreationTime -Descending

# Xem k√≠ch th∆∞·ªõc backup
Get-ChildItem "D:\backup\application\" | Select-Object Name, Length, CreationTime
```

---

## üöÄ **5. Smart Backup (T·ªïng H·ª£p)**

### **5.1. Backup To√†n B·ªô H·ªá Th·ªëng**
```powershell
# Backup database + application + configuration
.\scripts\smart-backup.ps1
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
```
Smart DCE Backup System
Test 1: Creating backup directories...
Created: D:\backup\database
Created: D:\backup\application
Created: D:\Project\app\logs\backup

Test 2: Smart application backup...
Backed up: backend\src
Backed up: backend\package.json
...
Smart application backup completed: D:\backup\application\app-backup-20250824_171540
Backup size: 5.22 MB
Items backed up: 11

Test 3: Configuration backup...
Backed up: .env
Backed up: nginx\conf\nginx.conf
...

Test 4: Backup compression...
Backup compressed: D:\backup\application\app-backup-20250824_171540.zip
Original size: 5.22 MB
Compressed size: 2.85 MB
Compression ratio: 45.44%

Test 5: Creating backup report...
Backup report created: D:\Project\app\logs\backup\smart-backup-report-20250824_171540.json
```

### **5.2. Ki·ªÉm tra Backup Reports**
```powershell
# Xem backup reports
Get-ChildItem "D:\Project\app\logs\backup\" | Where-Object {$_.Name -like "*report*"} | Sort-Object CreationTime -Descending

# Xem n·ªôi dung report m·ªõi nh·∫•t
Get-Content "D:\Project\app\logs\backup\smart-backup-report-20250824_171540.json" | ConvertFrom-Json | Format-List
```

---

## üîß **6. Maintenance**

### **6.1. Ch·∫°y Maintenance H√†ng Ng√†y**
```powershell
# Ch·∫°y maintenance t·ª± ƒë·ªông
.\scripts\maintenance.ps1
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
```
DCE System Maintenance - 08/24/2025 16:25:47
Running health check...
Testing DCE Monitoring System...
...
Monitoring Test Completed!
Running backup check...
Smart DCE Backup System
...
Smart Backup Test Completed!
Cleaning up old logs...
Maintenance completed
```

### **6.2. Cleanup Backup C≈©**
```powershell
# Ch·∫°y cleanup backup c≈© h∆°n 7 ng√†y
.\scripts\backup-cleanup.ps1
```

### **6.3. Thi·∫øt L·∫≠p Scheduled Task (T·ª± ƒë·ªông)**
```powershell
# T·∫°o scheduled task ch·∫°y h√†ng ng√†y l√∫c 2:00 AM
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-ExecutionPolicy Bypass -File `"D:\Project\app\scripts\maintenance.ps1`""
$trigger = New-ScheduledTaskTrigger -Daily -At 2am
$principal = New-ScheduledTaskPrincipal -UserId "SYSTEM" -LogonType ServiceAccount -RunLevel Highest
Register-ScheduledTask -TaskName "DCE-System-Maintenance" -Action $action -Trigger $trigger -Principal $principal -Description "DCE System Daily Maintenance"

# T·∫°o scheduled task cleanup backup c≈© h∆°n 7 ng√†y (ch·∫°y h√†ng tu·∫ßn)
$cleanupAction = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-ExecutionPolicy Bypass -File `"D:\Project\app\scripts\backup-cleanup.ps1`""
$cleanupTrigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Sunday -At 3am
Register-ScheduledTask -TaskName "DCE-Backup-Cleanup" -Action $cleanupAction -Trigger $cleanupTrigger -Principal $principal -Description "DCE System Weekly Backup Cleanup"
```

---

## üîç **7. Troubleshooting**

### **7.1. L·ªói Database Connection**
```powershell
# Ki·ªÉm tra SQL Server service
Get-Service -Name "*SQL*"

# Ki·ªÉm tra port 1433
Test-NetConnection -ComputerName localhost -Port 1433

# Ki·ªÉm tra file .env
Get-Content "D:\Project\app\backend\.env" | Select-String "DB_"
```

### **7.2. L·ªói Backup**
```powershell
# Ki·ªÉm tra quy·ªÅn th∆∞ m·ª•c backup
Get-Acl "D:\backup\database"
Get-Acl "D:\backup\application"

# Ki·ªÉm tra dung l∆∞·ª£ng ·ªï ƒëƒ©a
Get-WmiObject -Class Win32_LogicalDisk | Select-Object DeviceID, Size, FreeSpace
```

### **7.3. L·ªói Monitoring**
```powershell
# Ki·ªÉm tra WMI service
Get-Service -Name "Winmgmt"

# Ki·ªÉm tra PowerShell execution policy
Get-ExecutionPolicy

# Ki·ªÉm tra logs
Get-ChildItem "D:\Project\app\logs\" -Recurse | Sort-Object CreationTime -Descending | Select-Object -First 10
```

### **7.4. L·ªói Environment Variables**
```powershell
# Ki·ªÉm tra environment variables
[Environment]::GetEnvironmentVariable("DB_PASS", "Process")
[Environment]::GetEnvironmentVariable("DB_NAME", "Process")

# Reload environment
.\scripts\configure-env.ps1
```

---

## üìä **8. Monitoring Dashboard**

### **8.1. T·∫°o Script Monitoring Dashboard**
```powershell
# T·∫°o file monitoring-dashboard.ps1
@"
Write-Host "=== DCE System Dashboard ===" -ForegroundColor Green
Write-Host "Thoi gian: $(Get-Date)" -ForegroundColor Yellow

# System Resources
$cpu = (Get-WmiObject -Class Win32_Processor | Measure-Object -Property LoadPercentage -Average).Average
$memory = Get-WmiObject -Class Win32_OperatingSystem
$memoryUsage = [math]::Round((($memory.TotalVisibleMemorySize - $memory.FreePhysicalMemory) / $memory.TotalVisibleMemorySize) * 100, 2)
$disk = Get-WmiObject -Class Win32_LogicalDisk -Filter "DeviceID='C:'"
$diskFree = [math]::Round($disk.FreeSpace / 1GB, 2)

Write-Host "`nSystem Resources:" -ForegroundColor Cyan
Write-Host "CPU Usage: $cpu%" -ForegroundColor $(if($cpu -lt 80) { 'Green' } else { 'Red' })
Write-Host "Memory Usage: $memoryUsage%" -ForegroundColor $(if($memoryUsage -lt 90) { 'Green' } else { 'Red' })
Write-Host "Disk Free: $diskFree GB" -ForegroundColor $(if($diskFree -gt 10) { 'Green' } else { 'Red' })

# Database Status
$sqlService = Get-Service -Name "*SQL*" -ErrorAction SilentlyContinue
Write-Host "`nDatabase Status:" -ForegroundColor Cyan
if ($sqlService) {
    Write-Host "SQL Server: $($sqlService.Status)" -ForegroundColor $(if($sqlService.Status -eq 'Running') { 'Green' } else { 'Red' })
} else {
    Write-Host "SQL Server: Not Found" -ForegroundColor Red
}

# Backup Status
$latestDbBackup = Get-ChildItem "D:\backup\database\" -ErrorAction SilentlyContinue | Sort-Object CreationTime -Descending | Select-Object -First 1
$latestAppBackup = Get-ChildItem "D:\backup\application\" -ErrorAction SilentlyContinue | Sort-Object CreationTime -Descending | Select-Object -First 1

Write-Host "`nBackup Status:" -ForegroundColor Cyan
if ($latestDbBackup) {
    $dbBackupAge = (Get-Date) - $latestDbBackup.CreationTime
    Write-Host "Latest DB Backup: $($latestDbBackup.Name) ($([math]::Round($dbBackupAge.TotalHours, 1)) hours ago)" -ForegroundColor $(if($dbBackupAge.TotalHours -lt 24) { 'Green' } else { 'Yellow' })
} else {
    Write-Host "No database backup found" -ForegroundColor Red
}

if ($latestAppBackup) {
    $appBackupAge = (Get-Date) - $latestAppBackup.CreationTime
    Write-Host "Latest App Backup: $($latestAppBackup.Name) ($([math]::Round($appBackupAge.TotalHours, 1)) hours ago)" -ForegroundColor $(if($appBackupAge.TotalHours -lt 24) { 'Green' } else { 'Yellow' })
} else {
    Write-Host "No application backup found" -ForegroundColor Red
}
"@ | Out-File "D:\Project\app\scripts\monitoring-dashboard.ps1" -Encoding UTF8
```

### **8.2. Ch·∫°y Dashboard**
```powershell
# Ch·∫°y monitoring dashboard
.\scripts\monitoring-dashboard.ps1
```

---

## üéØ **9. Best Practices**

### **9.1. L·ªãch Tr√¨nh Backup**
- **Database Full Backup**: H√†ng ng√†y l√∫c 2:00 AM
- **Database Differential**: M·ªói 4 gi·ªù
- **Transaction Log**: M·ªói 15 ph√∫t
- **Application Backup**: H√†ng ng√†y l√∫c 3:00 AM
- **Maintenance**: H√†ng ng√†y l√∫c 4:00 AM

### **9.2. Monitoring Thresholds**
- **CPU Usage**: C·∫£nh b√°o khi > 80%
- **Memory Usage**: C·∫£nh b√°o khi > 90%
- **Disk Space**: C·∫£nh b√°o khi < 10GB
- **Backup Age**: C·∫£nh b√°o khi > 24 gi·ªù

### **9.3. Backup Retention**
- **Database Backups**: Gi·ªØ 7 ng√†y (t·ª± ƒë·ªông x√≥a)
- **Application Backups**: Gi·ªØ 7 ng√†y (t·ª± ƒë·ªông x√≥a)
- **Logs**: Gi·ªØ 7 ng√†y

### **9.4. Security**
- **File .env**: Ch·ªâ admin c√≥ quy·ªÅn ƒë·ªçc
- **Backup Files**: Ch·ªâ admin c√≥ quy·ªÅn truy c·∫≠p
- **Logs**: Kh√¥ng ch·ª©a th√¥ng tin nh·∫°y c·∫£m

---

## üìû **10. Support**

### **10.1. Logs Location**
- **Backup Logs**: `D:\Project\app\logs\backup\`
- **Monitoring Logs**: `D:\Project\app\logs\monitoring\`
- **System Logs**: `D:\Project\app\logs\`

### **10.2. Emergency Contacts**
- **System Admin**: [Your Contact]
- **Database Admin**: [Your Contact]
- **Backup Location**: `D:\backup\`

### **10.3. Recovery Procedures**
1. **Database Recovery**: S·ª≠ d·ª•ng backup file t·ª´ `D:\backup\database\`
2. **Application Recovery**: Restore t·ª´ `D:\backup\application\`
3. **Configuration Recovery**: Restore t·ª´ backup configuration

---

**üéâ H·ªá th·ªëng DCE Monitoring & Backup ƒë√£ s·∫µn s√†ng cho production!**
